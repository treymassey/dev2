from fastapi import Header, HTTPException

import os
API_KEY = os.getenv("API_KEY", "key")

def require_key(x_api_key: str = Header(None, alias="x-api-key")):
    if not x_api_key:
        raise HTTPException(status_code=401, detail="Missing x-api-key")
    if x_api_key.strip() != API_KEY.strip():
        raise HTTPException(status_code=401, detail="Unauthorized")


#debug
from fastapi import FastAPI, Request
app = FastAPI()

@app.get("/debug/headers")
async def debug_headers(request: Request):
    return {"headers": dict(request.headers)}


curl -v -X POST "$uri" \
  -H "Content-Type: application/json" \
  -H "x-api-key: key" \
  --data-binary @app/json_templates/meeting_chat_send.json
